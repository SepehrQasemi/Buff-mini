universe:
  symbols:
    - BTC/USDT
    - ETH/USDT
  timeframe: 1h
  start: "2023-01-01T00:00:00Z"
  end: null

costs:
  # Percent units: 0.1 means 0.1% round-trip.
  round_trip_cost_pct: 0.1
  slippage_pct: 0.0005
  funding_pct_per_day: 0.0

risk:
  risk_per_trade_pct: 0.01
  max_drawdown_pct: 0.25
  max_daily_loss_pct: 0.05
  max_concurrent_positions: 1
  max_gross_exposure: 5.0
  max_net_exposure_per_symbol: 5.0
  max_open_positions: 10
  sizing:
    mode: risk_budget
    risk_per_trade_pct: 1.0
    fixed_fraction_pct: 10.0
  killswitch:
    enabled: true
    max_daily_loss_pct: 5.0
    max_peak_to_valley_dd_pct: 20.0
    max_consecutive_losses: 8
    cool_down_bars: 48
  reeval:
    cadence: weekly
    min_new_bars: 168

execution:
  mode: net
  per_symbol_netting: true
  allow_opposite_signals: false
  symbol_scope: per_symbol

search:
  candidates: 100
  seed: 42

data:
  backend: parquet

portfolio:
  walkforward:
    min_usable_windows: 3
    min_forward_trades: 10
    min_forward_exposure: 0.01
    pf_clip_max: 5.0
    stability_metric: exp_lcb
  leverage_selector:
    methods: ["equal", "vol"]
    leverage_levels: [1, 2, 3, 5, 10, 15, 20, 25, 50]
    bootstrap: block
    block_size_trades: 10
    n_paths: 20000
    seed: 42
    initial_equity: 10000
    ruin_dd_threshold: 0.5
    constraints:
      max_p_ruin: 0.01
      max_dd_p95: 0.25
      min_return_p05: 0.0
    utility:
      objective: expected_log_growth
      epsilon: 1.0e-12
      use_final_equity: true
      penalize_dd: false
    reporting:
      include_per_leverage_tables: true
      include_binding_constraints: true

evaluation:
  stage0_enabled: true
  stage06:
    window_months: 36
    end_mode: latest
  stage1:
    enabled: true
    candidate_count: 5000
    top_k: 100
    top_m: 20
    stage_a_months: 9
    stage_b_months: 24
    holdout_months: 9
    split_mode: "60_20_20"
    min_holdout_trades: 50
    recent_weight: 2.0
    min_validation_exposure_ratio: 0.01
    min_validation_active_days: 10
    target_trades_per_month_holdout: 8
    low_signal_penalty_weight: 1.0
    min_trades_per_month_floor: 2
    allow_rare_if_high_expectancy: false
    rare_expectancy_threshold: 3.0
    rare_penalty_relief: 0.1
    result_thresholds:
      TierA:
        min_exp_lcb_holdout: 0
        min_effective_edge: 0
        min_trades_per_month_holdout: 5
        min_pf_adj_holdout: 1.1
        max_drawdown_holdout: 0.15
        min_exposure_ratio: 0.02
      TierB:
        min_exp_lcb_holdout: 0
        min_effective_edge: 0
        min_trades_per_month_holdout: 2.0
        min_pf_adj_holdout: 1.05
        max_drawdown_holdout: 0.20
        min_exposure_ratio: 0.02
      NearMiss:
        min_exp_lcb_holdout: -5
    promotion_holdout_months: [3, 6, 9, 12]
    walkforward_splits: 3
    early_stop_patience: 1000
    min_stage_a_evals: 1000
    instability_perturbations: 2
    weights:
      expectancy: 1.0
      log_profit_factor: 1.5
      max_drawdown: 1.0
      complexity: 0.5
      instability: 0.75
    search_space:
      families:
        - DonchianBreakout
        - RSIMeanReversion
        - TrendPullback
        - BollingerMeanReversion
        - RangeBreakoutTrendFilter
      gating_modes:
        - none
        - vol
        - vol+regime
      exit_modes:
        - fixed_atr
        - breakeven_1r
        - trailing_atr
        - partial_then_trail
      donchian_periods:
        - 20
        - 55
        - 100
      ema_pairs:
        - [20, 200]
        - [50, 200]
        - [50, 100]
      rsi_long_entry_min: 20
      rsi_long_entry_max: 40
      rsi_short_entry_min: 60
      rsi_short_entry_max: 80
      bollinger_period: 20
      bollinger_stds:
        - 1.5
        - 2.0
        - 2.5
      atr_sl_min: 0.8
      atr_sl_max: 2.5
      atr_tp_min: 1.0
      atr_tp_max: 5.0
      trailing_atr_k_min: 1.0
      trailing_atr_k_max: 2.5
      max_holding_bars:
        - 12
        - 24
        - 48
        - 96
  stage4:
    source_stage2_run_id: ""
    source_stage3_3_run_id: ""
    default_method: equal
    default_leverage: 1.0
    output:
      write_docs_summary: true
      write_run_artifacts: true

ui:
  stage5:
    presets:
      quick:
        candidate_count: 1000
        run_stage4_simulate: 0
      full:
        candidate_count: 5000
        run_stage4_simulate: 0
    window_months_options: [3, 6, 12, 36]
